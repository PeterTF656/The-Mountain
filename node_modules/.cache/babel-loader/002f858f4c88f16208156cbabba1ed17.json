{"ast":null,"code":"var _jsxFileName = \"/Users/zelinpu/Desktop/the-mountain/src/App.js\";\n// 1. Install dependencies DONE\n// 2. Import dependencies DONE\n// 3. Setup webcam and canvas DONE\n// 4. Define references to those DONE\n// 5. Load posenet DONE\n// 6. Detect function DONE\n// 7. Drawing utilities from tensorflow DONE\n// 8. Draw functions DONE\n// Face Mesh - https://github.com/tensorflow/tfjs-models/tree/master/facemesh\nimport React, { useRef, useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport * as tf from \"@tensorflow/tfjs\"; // OLD MODEL\n//import * as facemesh from \"@tensorflow-models/facemesh\";\n// NEW MODEL\n\nimport * as facemesh from \"@tensorflow-models/face-landmarks-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawTri } from \"./utilities\";\nimport { drawDots } from \"./Dots\";\nimport DasAlerts from \"./report\";\nimport AppBar from \"./AppBar\";\nimport { Button, Container, ButtonGroup, makeStyles } from '@material-ui/core';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    '& > *': {\n      margin: theme.spacing()\n    }\n  }\n}));\n\nfunction App() {\n  const classes = useStyles();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const canvasRef_Tri = useRef(null);\n  const photoRef = useRef(null);\n  const stripRef = useRef(null);\n  const [draw, setDraw] = useState(0);\n  const [visible, setAlertVisibility] = useState(false);\n  const [eyeVisible, setEyeVisibility] = useState(false);\n  const [id_2, setId_2] = useState([0.1, 0.1]);\n  const [id_152, setId_152] = useState([0.11, 0.11]);\n  const [id_9, setId_9] = useState([0.111, 0.111]);\n  const [id_10, setId_10] = useState([0.1111, 0.1111]);\n  const [id_127, setId_127] = useState([0.2, 0.2]);\n  const [id_130, setId_130] = useState([0.21, 0.21]);\n  const [id_243, setId_243] = useState([0.12, 0.12]);\n  const [id_463, setId_463] = useState([0.122, 0.122]);\n  const [id_359, setId_359] = useState([0.212, 0.212]);\n  const [id_356, setId_356] = useState([0.01, 0.01]);\n  const [showCanvas, setShowCanvas] = useState(true); //draw canvas pictures\n\n  const paintToCanvas = () => {\n    let video = webcamRef.current;\n    let photo = photoRef.current;\n    let ctx = photo.getContext(\"2d\");\n    const width = 320;\n    const height = 240;\n    photo.width = width;\n    photo.height = height;\n    return setInterval(() => {\n      ctx.drawImage(video, 0, 0, width, height);\n    }, 200);\n  }; // take photos\n\n\n  const takePhoto = () => {\n    let photo = photoRef.current;\n    let strip = stripRef.current;\n    console.warn(strip);\n    const data = photo.toDataURL(\"image/jpeg\");\n    console.warn(data);\n    const link = document.createElement(\"a\");\n    link.href = data;\n    link.setAttribute(\"download\", \"myWebcam\");\n    link.innerHTML = `<img src='${data}' alt='thumbnail'/>`;\n    strip.insertBefore(link, strip.firstChild);\n  }; //  Load posenet\n\n\n  const runFaceTri = async key => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    setInterval(() => {\n      detectTri(net, key);\n    }, 1);\n  };\n\n  const detectTri = async (net, key) => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight; // Set video width\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight; // Set canvas width\n\n      if (canvasRef_Tri.current !== null) {\n        canvasRef_Tri.current.width = videoWidth;\n        canvasRef_Tri.current.height = videoHeight;\n      }\n\n      const face = await net.estimateFaces({\n        input: video\n      }); // console.log(face);\n\n      if (typeof face[\"0\"] !== \"undefined\") {\n        // face[\"0\"].scaledMesh[9] = parseFloat(face[\"0\"].scaledMesh[9]).toFixed(4);\n        // face[\"0\"].scaledMesh[10] = parseFloat(face[\"0\"].scaledMesh[10]).toFixed(4);\n        // face[\"0\"].scaledMesh[2] = parseFloat(face[\"0\"].scaledMesh[2]).toFixed(4);\n        // face[\"0\"].scaledMesh[152] = parseFloat(face[\"0\"].scaledMesh[152]).toFixed(4);\n        // face[\"0\"].scaledMesh[127] = parseFloat(face[\"0\"].scaledMesh[127]).toFixed(4);\n        // face[\"0\"].scaledMesh[130] = parseFloat(face[\"0\"].scaledMesh[130]).toFixed(4);\n        // face[\"0\"].scaledMesh[243] = parseFloat(face[\"0\"].scaledMesh[243]).toFixed(4);\n        // face[\"0\"].scaledMesh[463] = parseFloat(face[\"0\"].scaledMesh[463]).toFixed(4);\n        // face[\"0\"].scaledMesh[359] = parseFloat(face[\"0\"].scaledMesh[359]).toFixed(4);\n        // face[\"0\"].scaledMesh[356] = parseFloat(face[\"0\"].scaledMesh[356]).toFixed(4);\n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]);\n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      } // Get canvas context\n\n\n      if (canvasRef_Tri.current !== null) {\n        const ctx = canvasRef_Tri.current.getContext(\"2d\");\n        requestAnimationFrame(() => {\n          drawTri(face, ctx, draw, draw > 0 ? false : true);\n        });\n      }\n    }\n  };\n\n  const runFaceDots = async key => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    setInterval(() => {\n      detectDots(net, key);\n    }, 1);\n  };\n\n  const detectDots = async (net, key) => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight; // Set video width\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight; // Set canvas width\n\n      if (canvasRef.current !== null) {\n        canvasRef.current.width = videoWidth;\n        canvasRef.current.height = videoHeight;\n      } // Make Detections\n      // OLD MODEL\n      //       const face = await net.estimateFaces(video);\n      // NEW MODEL\n\n\n      const face = await net.estimateFaces({\n        input: video\n      }); // console.log(face);\n      // Get canvas context\n\n      if (canvasRef.current !== null) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        requestAnimationFrame(() => {\n          drawDots(face, ctx, draw, draw > 0 ? false : true);\n        });\n      }\n    }\n  };\n\n  useEffect(() => {\n    runFaceTri();\n    return () => {};\n  }, [showCanvas]);\n  useEffect(() => {\n    runFaceDots();\n    return () => {};\n  }, [showCanvas]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => takePhoto(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }\n  }, \"Take a photo\"), /*#__PURE__*/React.createElement(\"video\", {\n    onCanPlay: () => paintToCanvas(),\n    ref: webcamRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: photoRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: stripRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    variant: \"contained\",\n    color: \"secondary\",\n    \"aria-label\": \"contained primary button group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setDraw(draw + 1),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 9\n    }\n  }, \"\\u4E0B\\u4E00\\u4E2A\\u90E8\\u4F4D\\u5EFA\\u6A21\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setDraw(draw - 1),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 9\n    }\n  }, \"\\u8FD4\\u56DE\\u4E0A\\u4E00\\u4E2A\\u90E8\\u4F4D\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    size: \"small\",\n    variant: \"contained\",\n    color: \"secondary\",\n    \"aria-label\": \"contained primary button group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setTimeout(() => {\n      setAlertVisibility(true);\n    }, 3000),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }\n  }, \"\\u5168\\u8138\\u626B\\u63CF\\u53CD\\u9988\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setTimeout(() => {\n      setEyeVisibility(true);\n    }, 5000),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }\n  }, \"\\u773C\\u90E8\\u626B\\u63CF\\u53CD\\u9988\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    size: \"small\",\n    variant: \"contained\",\n    color: \"secondary\",\n    \"aria-label\": \"contained primary button group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setShowCanvas(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }\n  }, \"\\u663E\\u793A\\u6807\\u70B9\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setShowCanvas(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }\n  }, \"\\u9690\\u85CF\\u6807\\u70B9\")))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: visible,\n    duration: 20000000,\n    onDurationEnd: setAlertVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 9\n    }\n  }, \"\\u4F60\\u7684\\u4E09\\u5EAD\\u6BD4\\u4F8B\\u4E3A\", (id_9[1] - id_10[1]) / (id_152[1] - id_10[1]), \":\", (id_2[1] - id_9[1]) / (id_152[1] - id_10[1]), \":\", (id_152[1] - id_2[1]) / (id_152[1] - id_10[1]), \";\", \"\\n\", \"\\u4F60\\u7684\\u4E94\\u773C\\u6BD4\\u4F8B\\u4E3A\", (id_130[0] - id_127[0]) / (id_356[0] - id_127[0]), \":\", (id_243[0] - id_130[0]) / (id_356[0] - id_127[0]), \":\", (id_463[0] - id_243[0]) / (id_356[0] - id_127[0]), \":\", (id_359[0] - id_463[0]) / (id_356[0] - id_127[0]), \":\", (id_356[0] - id_359[0]) / (id_356[0] - id_127[0])))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: eyeVisible,\n    duration: 20000000,\n    onDurationEnd: setEyeVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 9\n    }\n  }, \"\\u773C\\u775B\\u957F\\u5EA6\\u76F8\\u8F83\\u4E8E\\u4E94\\u773C\\u7684\\u6BD4\\u4F8B\\uFF1A\\u5408\\u9002\\uFF0885\\u5206\\uFF09\\uFF1B\\u773C\\u775B\\u5BBD\\u5EA6\\u76F8\\u8F83\\u4E8E\\u4E2D\\u5EAD\\u7684\\u6BD4\\u4F8B\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\uFF1B\\u7709\\u773C\\u8DDD\\u79BB\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\uFF1B\\u773C\\u95F4\\u8DDD\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\u3002\"))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: eyeVisible,\n    duration: 20000000,\n    onDurationEnd: setEyeVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 9\n    }\n  }, \"\\u5EFA\\u8BAE\\uFF1A\\u4F7F\\u7528\\u5986\\u5BB9\\uFF1A\\u65E5\\u5E38\\u5986\\u5BB9\\u3002 \", \"\\n\", \"1. \\u7709\\u5934\\u81F3\\u773C\\u89D2C\\u578B\\u533A\\u4E0A\\u9634\\u5F71\\uFF0C\\u52A0\\u5F3A\\u7ACB\\u4F53\\u611F\\u3002 \", \"\\n\", \"2. \\u7531\\u773C\\u76AE\\u81F3\\u7709\\u5C3E\\u4F7F\\u7528\\u6DF1\\u8272\\u7CFB\\u773C\\u5F71\\u6DE1\\u626B\\uFF0C\\u52A0\\u5F3A\\u5C42\\u6B21\\u611F  \", \"\\n\", \"3. \\u5728\\u4E0B\\u773C\\u7751\\u548C\\u773C\\u5C3E\\u4F7F\\u7528\\u6DF1\\u8272\\u7CFB\\u773C\\u5F71\\u6DE1\\u626B\\uFF0C\\u62C9\\u957F\\u773C\\u957F \", \"\\n\", \"4. \\u4F7F\\u7528\\u68D5\\u6A58\\u8272\\u52A0\\u6DF1\\u8936\\u76B1\\u548C\\u4E0B\\u773C\\u5C3E \", \"\\n\", \" 5. \\u5728\\u77B3\\u5B54\\u6B63\\u4E0A\\u65B9\\u773C\\u76AE\\u4F7F\\u7528\\u4EAE\\u8272\\u70B9\\u6D82  \", \"\\n\", \"6. \\u753B\\u5185\\u773C\\u7EBF\\u548C\\u5916\\u773C\\u7EBF\\uFF0C\\u5916\\u773C\\u7EBF\\u773C\\u5C3E\\u5FAE\\u5FAE\\u4E0A\\u7FD8\\u3002\\u82E5\\u8936\\u76B1\\u660E\\u663E\\uFF0C\\u5EFA\\u8BAE\\u7701\\u7565\\u5916\\u773C\\u7EBF\\uFF0C\\u907F\\u514D\\u5986\\u611F\\u8FC7\\u91CD  \", \"\\n\", \"7. \\u5939\\u776B\\u6BDB\\uFF0C\\u4E0A\\u776B\\u6BDB\\u818F\"))), /*#__PURE__*/React.createElement(\"header\", {\n    className: \"App-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamRef,\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 9\n    }\n  }), showCanvas === true && /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 9\n    }\n  }), showCanvas === false && /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef_Tri,\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/zelinpu/Desktop/the-mountain/src/App.js"],"names":["React","useRef","useEffect","useState","tf","facemesh","Webcam","drawTri","drawDots","DasAlerts","AppBar","Button","Container","ButtonGroup","makeStyles","useStyles","theme","root","display","flexDirection","alignItems","margin","spacing","App","classes","webcamRef","canvasRef","canvasRef_Tri","photoRef","stripRef","draw","setDraw","visible","setAlertVisibility","eyeVisible","setEyeVisibility","id_2","setId_2","id_152","setId_152","id_9","setId_9","id_10","setId_10","id_127","setId_127","id_130","setId_130","id_243","setId_243","id_463","setId_463","id_359","setId_359","id_356","setId_356","showCanvas","setShowCanvas","paintToCanvas","video","current","photo","ctx","getContext","width","height","setInterval","drawImage","takePhoto","strip","console","warn","data","toDataURL","link","document","createElement","href","setAttribute","innerHTML","insertBefore","firstChild","runFaceTri","key","net","load","SupportedPackages","mediapipeFacemesh","detectTri","readyState","videoWidth","videoHeight","face","estimateFaces","input","scaledMesh","requestAnimationFrame","runFaceDots","detectDots","setTimeout","position","marginLeft","marginRight","left","right","textAlign","zindex"],"mappings":"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","sourcesContent":["// 1. Install dependencies DONE\n// 2. Import dependencies DONE\n// 3. Setup webcam and canvas DONE\n// 4. Define references to those DONE\n// 5. Load posenet DONE\n// 6. Detect function DONE\n// 7. Drawing utilities from tensorflow DONE\n// 8. Draw functions DONE\n\n// Face Mesh - https://github.com/tensorflow/tfjs-models/tree/master/facemesh\n\nimport React, { useRef, useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport * as tf from \"@tensorflow/tfjs\";\n// OLD MODEL\n//import * as facemesh from \"@tensorflow-models/facemesh\";\n\n// NEW MODEL\nimport * as facemesh from \"@tensorflow-models/face-landmarks-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawTri } from \"./utilities\";\nimport { drawDots } from \"./Dots\"\nimport DasAlerts from \"./report\";\nimport AppBar from \"./AppBar\";\n\nimport {Button, Container, ButtonGroup, makeStyles} from '@material-ui/core';\n\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    '& > *': {\n      margin: theme.spacing(),\n    },\n  },\n}));\n\n\nfunction App() {\n  const classes = useStyles();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const canvasRef_Tri = useRef(null);\n  const photoRef = useRef(null);\n  const stripRef = useRef(null);\n  const [draw, setDraw] = useState(0);\n  const [visible, setAlertVisibility] = useState(false);\n  const [eyeVisible, setEyeVisibility] = useState(false);\n  const [id_2, setId_2] = useState([0.1,0.1])\n  const [id_152, setId_152] = useState([0.11,0.11])\n  const [id_9, setId_9] = useState([0.111,0.111])\n  const [id_10, setId_10] = useState([0.1111,0.1111])\n  const [id_127, setId_127] = useState([0.2,0.2])\n  const [id_130, setId_130] = useState([0.21,0.21])\n  const [id_243, setId_243] = useState([0.12,0.12])\n  const [id_463, setId_463] = useState([0.122,0.122])\n  const [id_359, setId_359] = useState([0.212,0.212])\n  const [id_356, setId_356] = useState([0.01,0.01])\n  const [showCanvas, setShowCanvas] = useState(true)\n\n\n  //draw canvas pictures\n\n  const paintToCanvas = () => {\n    let video = webcamRef.current;\n    let photo = photoRef.current;\n    let ctx = photo.getContext(\"2d\");\n\n    const width = 320;\n    const height = 240;\n    photo.width = width;\n    photo.height = height;\n\n    return setInterval(() => {\n      ctx.drawImage(video, 0, 0, width, height);\n    }, 200);\n  };\n\n  // take photos\n  const takePhoto = () => {\n    let photo = photoRef.current;\n    let strip = stripRef.current;\n\n    console.warn(strip);\n\n    const data = photo.toDataURL(\"image/jpeg\");\n\n    console.warn(data);\n    const link = document.createElement(\"a\");\n    link.href = data;\n    link.setAttribute(\"download\", \"myWebcam\");\n    link.innerHTML = `<img src='${data}' alt='thumbnail'/>`;\n    strip.insertBefore(link, strip.firstChild);\n  };\n\n  //  Load posenet\n  const runFaceTri = async (key) => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    setInterval(() => {\n      detectTri(net, key);\n    }, 1);\n  };\n\n  const detectTri = async (net, key) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight;\n\n      // Set video width\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      // Set canvas width\n      if (canvasRef_Tri.current !== null) {\n      canvasRef_Tri.current.width = videoWidth;\n      canvasRef_Tri.current.height = videoHeight;\n      }\n\n      const face = await net.estimateFaces({input:video});\n      // console.log(face);\n\n      \n      if (typeof face[\"0\"] !== \"undefined\") {        \n        // face[\"0\"].scaledMesh[9] = parseFloat(face[\"0\"].scaledMesh[9]).toFixed(4);\n        // face[\"0\"].scaledMesh[10] = parseFloat(face[\"0\"].scaledMesh[10]).toFixed(4);\n        // face[\"0\"].scaledMesh[2] = parseFloat(face[\"0\"].scaledMesh[2]).toFixed(4);\n        // face[\"0\"].scaledMesh[152] = parseFloat(face[\"0\"].scaledMesh[152]).toFixed(4);\n        // face[\"0\"].scaledMesh[127] = parseFloat(face[\"0\"].scaledMesh[127]).toFixed(4);\n        // face[\"0\"].scaledMesh[130] = parseFloat(face[\"0\"].scaledMesh[130]).toFixed(4);\n        // face[\"0\"].scaledMesh[243] = parseFloat(face[\"0\"].scaledMesh[243]).toFixed(4);\n        // face[\"0\"].scaledMesh[463] = parseFloat(face[\"0\"].scaledMesh[463]).toFixed(4);\n        // face[\"0\"].scaledMesh[359] = parseFloat(face[\"0\"].scaledMesh[359]).toFixed(4);\n        // face[\"0\"].scaledMesh[356] = parseFloat(face[\"0\"].scaledMesh[356]).toFixed(4);\n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]); \n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      }\n\n      // Get canvas context\n      if (canvasRef_Tri.current !== null) {\n      const ctx = canvasRef_Tri.current.getContext(\"2d\");\n      requestAnimationFrame(()=>{drawTri(face, ctx, draw, (draw > 0 ? false : true))});\n      }\n    }\n  };\n\n  const runFaceDots = async (key) => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    setInterval(() => {\n      detectDots(net, key);\n    }, 1);\n  };\n\n  const detectDots = async (net, key) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight;\n\n      // Set video width\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      // Set canvas width\n      if (canvasRef.current !== null) {\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      }\n\n      // Make Detections\n      // OLD MODEL\n      //       const face = await net.estimateFaces(video);\n      // NEW MODEL\n      const face = await net.estimateFaces({input:video});\n      // console.log(face);\n      // Get canvas context\n      if (canvasRef.current !== null) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      requestAnimationFrame(()=>{drawDots(face, ctx, draw, (draw > 0 ? false : true))});\n      }\n    }\n  };\n\n  useEffect(()=>{runFaceTri(); return () => {}},[showCanvas]);\n  useEffect(()=>{runFaceDots(); return () => {}}, [showCanvas])\n\n  return (\n    <div className=\"App\">\n      <AppBar/>\n      <Container>\n      <Button onClick={() => takePhoto()}>Take a photo</Button>\n      <video onCanPlay={() => paintToCanvas()} ref={webcamRef} />\n      <canvas ref={photoRef} />\n      <div>\n        <div ref={stripRef} />\n      </div>\n      <div className={classes.root}>\n      <ButtonGroup variant=\"contained\" color=\"secondary\" aria-label=\"contained primary button group\">\n        <Button\n          onClick={() => setDraw(draw + 1)}\n        >\n          下一个部位建模\n        </Button>\n        <Button\n          onClick={() => setDraw(draw - 1)}\n        >\n          返回上一个部位\n        </Button>\n        </ButtonGroup>\n      </div>\n      {/* <div>current draw is {draw}.</div> */}\n      <div className={classes.root}>\n      <ButtonGroup size=\"small\" variant=\"contained\" color=\"secondary\" aria-label=\"contained primary button group\">\n      <Button \n        onClick={()=> setTimeout(() => {setAlertVisibility(true)},3000)}>\n          全脸扫描反馈\n      </Button>\n      <Button \n        onClick={()=> setTimeout(() => {setEyeVisibility(true)},5000)}>\n          眼部扫描反馈\n      </Button>\n      </ButtonGroup>\n      </div>\n      <div className={classes.root}>\n      <ButtonGroup size=\"small\" variant=\"contained\" color=\"secondary\" aria-label=\"contained primary button group\">\n      <Button \n        onClick={()=>{setShowCanvas(true)}}>\n          显示标点\n      </Button>\n      <Button \n        onClick={()=> {setShowCanvas(false)}}>\n          隐藏标点\n      </Button>\n      </ButtonGroup>\n      </div>\n\n      </Container>\n      <div>\n      <DasAlerts\n        visible={visible}\n        duration={20000000}\n        onDurationEnd={setAlertVisibility}\n      >\n        <div>你的三庭比例为{(id_9[1]-id_10[1])/(id_152[1]-id_10[1])}:{(id_2[1]-id_9[1])/(id_152[1]-id_10[1])}:{(id_152[1]-id_2[1])/(id_152[1]-id_10[1])};{\"\\n\"}\n        你的五眼比例为{(id_130[0]-id_127[0])/(id_356[0]-id_127[0])}:{(id_243[0]-id_130[0])/(id_356[0]-id_127[0])}:{(id_463[0]-id_243[0])/(id_356[0]-id_127[0])}:\n        {(id_359[0]-id_463[0])/(id_356[0]-id_127[0])}:\n        {(id_356[0]-id_359[0])/(id_356[0]-id_127[0])}\n        </div>\n        </DasAlerts>\n      </div>\n      <div>\n      <DasAlerts\n        visible={eyeVisible}\n        duration={20000000}\n        onDurationEnd={setEyeVisibility}\n      >\n        <div>眼睛长度相较于五眼的比例：合适（85分）；眼睛宽度相较于中庭的比例：合适（80分）；眉眼距离：合适（80分）；眼间距：合适（80分）。</div>\n        </DasAlerts>\n      </div>\n      <div>\n      <DasAlerts\n        visible={eyeVisible}\n        duration={20000000}\n        onDurationEnd={setEyeVisibility}\n      >\n        <div>建议：使用妆容：日常妆容。 {\"\\n\"}1. 眉头至眼角C型区上阴影，加强立体感。 {\"\\n\"} \n        2. 由眼皮至眉尾使用深色系眼影淡扫，加强层次感  {\"\\n\"}3. 在下眼睑和眼尾使用深色系眼影淡扫，拉长眼长 {\"\\n\"} \n        4. 使用棕橘色加深褶皱和下眼尾 {\"\\n\"} 5. 在瞳孔正上方眼皮使用亮色点涂  {\"\\n\"}\n        6. 画内眼线和外眼线，外眼线眼尾微微上翘。若褶皱明显，建议省略外眼线，避免妆感过重  {\"\\n\"}\n        7. 夹睫毛，上睫毛膏</div>\n        </DasAlerts>\n      </div>\n      <header className=\"App-header\">\n        <Webcam\n          ref={webcamRef}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />\n        {showCanvas === true &&\n        <canvas\n          ref={canvasRef}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />}\n        {showCanvas === false &&\n        <canvas\n          ref={canvasRef_Tri}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />}\n\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}