{"ast":null,"code":"var _jsxFileName = \"/Users/zelinpu/Desktop/the-mountain/src/App.js\";\n// 1. Install dependencies DONE\n// 2. Import dependencies DONE\n// 3. Setup webcam and canvas DONE\n// 4. Define references to those DONE\n// 5. Load posenet DONE\n// 6. Detect function DONE\n// 7. Drawing utilities from tensorflow DONE\n// 8. Draw functions DONE\n// Face Mesh - https://github.com/tensorflow/tfjs-models/tree/master/facemesh\nimport React, { useRef, useEffect, useState, useCallback } from \"react\";\nimport \"./App.css\";\nimport * as tf from \"@tensorflow/tfjs\"; // NEW MODEL\n\nimport * as facemesh from \"@tensorflow-models/face-landmarks-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawTri } from \"./utilities\";\nimport { drawDots } from \"./Dots\";\nimport DasAlerts from \"./report\";\nimport AppBar from \"./AppBar\";\nimport { Button, Container, ButtonGroup, makeStyles, Fab, Grid, Box } from '@material-ui/core';\nimport ImgCard from \"./Snip.js\";\nimport CameraAltRoundedIcon from '@material-ui/icons/CameraAltRounded'; // import EditIcon from '@material-ui/icons/Edit';\n// import UpIcon from '@material-ui/icons/KeyboardArrowUp';\n// import { green } from '@material-ui/core/colors';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    '& > *': {\n      margin: theme.spacing(),\n      marginTop: theme.spacing(3)\n    }\n  },\n  container_root: {\n    margin: theme.spacing(2),\n    display: 'flex'\n  },\n  fab_one: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2)\n  }\n}));\nlet timer;\nlet parts;\n\nfunction App() {\n  const classes = useStyles();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [showEyes, setShowEyes] = useState(false);\n  const [draw, setDraw] = useState(0);\n  const [visible, setAlertVisibility] = useState(false);\n  const [eyeVisible, setEyeVisibility] = useState(false);\n  const [id_2, setId_2] = useState([0.1, 0.1]);\n  const [id_152, setId_152] = useState([0.11, 0.11]);\n  const [id_9, setId_9] = useState([0.111, 0.111]);\n  const [id_10, setId_10] = useState([0.1111, 0.1111]);\n  const [id_127, setId_127] = useState([0.2, 0.2]);\n  const [id_130, setId_130] = useState([0.21, 0.21]);\n  const [id_243, setId_243] = useState([0.12, 0.12]);\n  const [id_463, setId_463] = useState([0.122, 0.122]);\n  const [id_359, setId_359] = useState([0.212, 0.212]);\n  const [id_356, setId_356] = useState([0.01, 0.01]);\n  const [showCanvas, setShowCanvas] = useState(true);\n  const [imgSrc, setImgSrc] = React.useState(null);\n  useEffect(() => {\n    console.log(\"useeffect canvas:\", showCanvas);\n\n    if (showCanvas) {\n      runFace();\n      return () => {\n        clearInterval(timer);\n      };\n    } else {\n      clearInterval(timer);\n    }\n  }, [showCanvas, draw]); // take photos\n\n  const capture = React.useCallback(() => {\n    const imageSrc = webcamRef.current.getScreenshot({\n      width: 400,\n      height: 400\n    });\n    setImgSrc(imageSrc);\n  }, [webcamRef, setImgSrc]);\n  parts = draw; //detect and draw dots on face\n\n  const runFace = useCallback(async show => {\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    console.log(parts);\n\n    if (parts === 1) {\n      console.log(\"running tri\");\n      timer = setInterval(() => {\n        detectTri(net);\n        console.log(showCanvas);\n      }, 10);\n    } else {\n      console.log(\"running dots\");\n      timer = setInterval(() => {\n        detectDots(net);\n        console.log(showCanvas);\n      }, 10);\n    }\n\n    return timer;\n  }, [showCanvas]);\n\n  const detectDots = async net => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight; // Set video width\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight; // Set canvas width\n\n      if (canvasRef.current !== null) {\n        canvasRef.current.width = videoWidth;\n        canvasRef.current.height = videoHeight;\n      }\n\n      const face = await net.estimateFaces({\n        input: video\n      });\n\n      if (typeof face[\"0\"] !== \"undefined\") {\n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]);\n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      } // Get canvas context\n\n\n      if (canvasRef.current !== null) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        requestAnimationFrame(() => {\n          drawDots(face, ctx, draw, showCanvas);\n        });\n      }\n    }\n  };\n\n  const detectTri = async net => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight; // Set video width\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight; // Set canvas width\n\n      if (canvasRef.current !== null) {\n        canvasRef.current.width = videoWidth;\n        canvasRef.current.height = videoHeight;\n      }\n\n      const face = await net.estimateFaces({\n        input: video\n      });\n\n      if (typeof face[\"0\"] !== \"undefined\") {\n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]);\n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      } // Get canvas context\n\n\n      if (canvasRef.current !== null) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        requestAnimationFrame(() => {\n          drawDots(face, ctx, 1, showCanvas);\n        });\n      }\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Container, {\n    className: classes.container_root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 2,\n    style: {\n      margin: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Fab, {\n    size: \"small\",\n    color: \"primary\",\n    \"aria-label\": \"add\",\n    onClick: capture,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(CameraAltRoundedIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 9\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 9,\n    display: \"flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    variant: \"contained\",\n    color: \"secondary\",\n    \"aria-label\": \"contained primary button group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setDraw(draw + 1),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 9\n    }\n  }, \"\\u4E0B\\u4E00\\u4E2A\\u90E8\\u4F4D\\u5EFA\\u6A21\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setDraw(draw - 1),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 9\n    }\n  }, \"\\u8FD4\\u56DE\\u4E0A\\u4E00\\u4E2A\\u90E8\\u4F4D\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setTimeout(() => {\n      setAlertVisibility(true);\n    }, 3000),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 9\n    }\n  }, \"\\u5168\\u8138\\u626B\\u63CF\\u53CD\\u9988\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setTimeout(() => {\n      setEyeVisibility(true);\n    }, 5000),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 7\n    }\n  }, \"\\u773C\\u90E8\\u626B\\u63CF\\u53CD\\u9988\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setShowCanvas(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }\n  }, \"\\u663E\\u793A\\u6807\\u70B9\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setShowCanvas(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }\n  }, \"\\u9690\\u85CF\\u6807\\u70B9\")))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }\n  }, \"current draw is \", draw, \".\"), /*#__PURE__*/React.createElement(Box, {\n    style: {\n      margin: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }\n  }, imgSrc &&\n  /*#__PURE__*/\n  // <img\n  //   src={imgSrc}\n  // />\n  React.createElement(ImgCard, {\n    img: imgSrc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: visible,\n    duration: 20000000,\n    onDurationEnd: setAlertVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }, \"\\u4F60\\u7684\\u4E09\\u5EAD\\u6BD4\\u4F8B\\u4E3A\", (id_9[1] - id_10[1]) / (id_152[1] - id_10[1]), \":\", (id_2[1] - id_9[1]) / (id_152[1] - id_10[1]), \":\", (id_152[1] - id_2[1]) / (id_152[1] - id_10[1]), \";\", \"\\n\", \"\\u4F60\\u7684\\u4E94\\u773C\\u6BD4\\u4F8B\\u4E3A\", (id_130[0] - id_127[0]) / (id_356[0] - id_127[0]), \":\", (id_243[0] - id_130[0]) / (id_356[0] - id_127[0]), \":\", (id_463[0] - id_243[0]) / (id_356[0] - id_127[0]), \":\", (id_359[0] - id_463[0]) / (id_356[0] - id_127[0]), \":\", (id_356[0] - id_359[0]) / (id_356[0] - id_127[0])))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: eyeVisible,\n    duration: 20000000,\n    onDurationEnd: setEyeVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 9\n    }\n  }, \"\\u773C\\u775B\\u957F\\u5EA6\\u76F8\\u8F83\\u4E8E\\u4E94\\u773C\\u7684\\u6BD4\\u4F8B\\uFF1A\\u5408\\u9002\\uFF0885\\u5206\\uFF09\\uFF1B\\u773C\\u775B\\u5BBD\\u5EA6\\u76F8\\u8F83\\u4E8E\\u4E2D\\u5EAD\\u7684\\u6BD4\\u4F8B\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\uFF1B\\u7709\\u773C\\u8DDD\\u79BB\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\uFF1B\\u773C\\u95F4\\u8DDD\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\u3002\"))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: eyeVisible,\n    duration: 20000000,\n    onDurationEnd: setEyeVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 9\n    }\n  }, \"\\u5EFA\\u8BAE\\uFF1A\\u4F7F\\u7528\\u5986\\u5BB9\\uFF1A\\u65E5\\u5E38\\u5986\\u5BB9\\u3002 \", \"\\n\", \"1. \\u7709\\u5934\\u81F3\\u773C\\u89D2C\\u578B\\u533A\\u4E0A\\u9634\\u5F71\\uFF0C\\u52A0\\u5F3A\\u7ACB\\u4F53\\u611F\\u3002 \", \"\\n\", \"2. \\u7531\\u773C\\u76AE\\u81F3\\u7709\\u5C3E\\u4F7F\\u7528\\u6DF1\\u8272\\u7CFB\\u773C\\u5F71\\u6DE1\\u626B\\uFF0C\\u52A0\\u5F3A\\u5C42\\u6B21\\u611F  \", \"\\n\", \"3. \\u5728\\u4E0B\\u773C\\u7751\\u548C\\u773C\\u5C3E\\u4F7F\\u7528\\u6DF1\\u8272\\u7CFB\\u773C\\u5F71\\u6DE1\\u626B\\uFF0C\\u62C9\\u957F\\u773C\\u957F \", \"\\n\", \"4. \\u4F7F\\u7528\\u68D5\\u6A58\\u8272\\u52A0\\u6DF1\\u8936\\u76B1\\u548C\\u4E0B\\u773C\\u5C3E \", \"\\n\", \" 5. \\u5728\\u77B3\\u5B54\\u6B63\\u4E0A\\u65B9\\u773C\\u76AE\\u4F7F\\u7528\\u4EAE\\u8272\\u70B9\\u6D82  \", \"\\n\", \"6. \\u753B\\u5185\\u773C\\u7EBF\\u548C\\u5916\\u773C\\u7EBF\\uFF0C\\u5916\\u773C\\u7EBF\\u773C\\u5C3E\\u5FAE\\u5FAE\\u4E0A\\u7FD8\\u3002\\u82E5\\u8936\\u76B1\\u660E\\u663E\\uFF0C\\u5EFA\\u8BAE\\u7701\\u7565\\u5916\\u773C\\u7EBF\\uFF0C\\u907F\\u514D\\u5986\\u611F\\u8FC7\\u91CD  \", \"\\n\", \"7. \\u5939\\u776B\\u6BDB\\uFF0C\\u4E0A\\u776B\\u6BDB\\u818F\"))), /*#__PURE__*/React.createElement(\"header\", {\n    className: \"App-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamRef,\n    screenshotFormat: \"image/jpeg\",\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 9\n    }\n  }), showCanvas === true && /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/zelinpu/Desktop/the-mountain/src/App.js"],"names":["React","useRef","useEffect","useState","useCallback","tf","facemesh","Webcam","drawTri","drawDots","DasAlerts","AppBar","Button","Container","ButtonGroup","makeStyles","Fab","Grid","Box","ImgCard","CameraAltRoundedIcon","useStyles","theme","root","display","flexDirection","alignItems","margin","spacing","marginTop","container_root","fab_one","position","bottom","left","timer","parts","App","classes","webcamRef","canvasRef","showEyes","setShowEyes","draw","setDraw","visible","setAlertVisibility","eyeVisible","setEyeVisibility","id_2","setId_2","id_152","setId_152","id_9","setId_9","id_10","setId_10","id_127","setId_127","id_130","setId_130","id_243","setId_243","id_463","setId_463","id_359","setId_359","id_356","setId_356","showCanvas","setShowCanvas","imgSrc","setImgSrc","console","log","runFace","clearInterval","capture","imageSrc","current","getScreenshot","width","height","show","net","load","SupportedPackages","mediapipeFacemesh","setInterval","detectTri","detectDots","video","readyState","videoWidth","videoHeight","face","estimateFaces","input","scaledMesh","ctx","getContext","requestAnimationFrame","setTimeout","marginLeft","marginRight","right","textAlign","zindex"],"mappings":"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","sourcesContent":["// 1. Install dependencies DONE\n// 2. Import dependencies DONE\n// 3. Setup webcam and canvas DONE\n// 4. Define references to those DONE\n// 5. Load posenet DONE\n// 6. Detect function DONE\n// 7. Drawing utilities from tensorflow DONE\n// 8. Draw functions DONE\n\n// Face Mesh - https://github.com/tensorflow/tfjs-models/tree/master/facemesh\nimport React, { useRef, useEffect, useState, useCallback } from \"react\";\nimport \"./App.css\";\nimport * as tf from \"@tensorflow/tfjs\";\n\n\n// NEW MODEL\nimport * as facemesh from \"@tensorflow-models/face-landmarks-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawTri } from \"./utilities\";\nimport { drawDots } from \"./Dots\"\nimport DasAlerts from \"./report\";\nimport AppBar from \"./AppBar\";\n\nimport {Button, Container, ButtonGroup, makeStyles, Fab, Grid, Box} from '@material-ui/core';\nimport ImgCard from \"./Snip.js\";\nimport CameraAltRoundedIcon from '@material-ui/icons/CameraAltRounded';\n// import EditIcon from '@material-ui/icons/Edit';\n// import UpIcon from '@material-ui/icons/KeyboardArrowUp';\n// import { green } from '@material-ui/core/colors';\n\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    '& > *': {\n      margin: theme.spacing(),\n      marginTop: theme.spacing(3),\n    },\n  },\n  container_root: {\n    margin: theme.spacing(2),\n    display: 'flex',\n  },\n  fab_one: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n  },\n}));\n\nlet timer;\nlet parts;\n\nfunction App() {\n  const classes = useStyles();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [showEyes, setShowEyes] = useState(false);\n  const [draw, setDraw] = useState(0);\n  const [visible, setAlertVisibility] = useState(false);\n  const [eyeVisible, setEyeVisibility] = useState(false);\n  const [id_2, setId_2] = useState([0.1,0.1])\n  const [id_152, setId_152] = useState([0.11,0.11])\n  const [id_9, setId_9] = useState([0.111,0.111])\n  const [id_10, setId_10] = useState([0.1111,0.1111])\n  const [id_127, setId_127] = useState([0.2,0.2])\n  const [id_130, setId_130] = useState([0.21,0.21])\n  const [id_243, setId_243] = useState([0.12,0.12])\n  const [id_463, setId_463] = useState([0.122,0.122])\n  const [id_359, setId_359] = useState([0.212,0.212])\n  const [id_356, setId_356] = useState([0.01,0.01])\n  const [showCanvas, setShowCanvas] = useState(true)\n  const [imgSrc, setImgSrc] = React.useState(null);\n\n  useEffect(()=>{\n    console.log(\"useeffect canvas:\", showCanvas)\n    if (showCanvas) {\n    runFace(); \n     return () => {clearInterval(timer)}\n    } else {\n      clearInterval(timer)\n    }\n    }, [showCanvas, draw])\n\n  // take photos\n    const capture = React.useCallback(() => {\n      const imageSrc = webcamRef.current.getScreenshot({width: 400, height: 400});\n      setImgSrc(imageSrc);\n    }, [webcamRef, setImgSrc]);\n    \n   parts = draw;\n  //detect and draw dots on face\n  const runFace = useCallback(async (show) => {\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    console.log(parts);\n    if (parts === 1){\n      console.log(\"running tri\");\n      timer = setInterval(() => {\n        detectTri(net) ;\n        console.log(showCanvas);\n      }, 10);\n    }else{\n      console.log(\"running dots\");\n    timer = setInterval(() => {\n      detectDots(net) ;\n      console.log(showCanvas);\n    }, 10);}\n    return timer;\n  },[showCanvas]);\n\n  const detectDots = async (net) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight;\n\n      // Set video width\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      // Set canvas width\n      if (canvasRef.current !== null) {\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      }\n      const face = await net.estimateFaces({input:video});\n\n      if (typeof face[\"0\"] !== \"undefined\") {        \n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]); \n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      }\n      // Get canvas context\n      if (canvasRef.current !== null) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      \n      requestAnimationFrame(()=>{drawDots(face, ctx, draw, showCanvas)});\n      }\n    }\n  };\n\n  const detectTri = async (net) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight;\n\n      // Set video width\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      // Set canvas width\n      if (canvasRef.current !== null) {\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      }\n      const face = await net.estimateFaces({input:video});\n\n      if (typeof face[\"0\"] !== \"undefined\") {        \n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]); \n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      }\n      // Get canvas context\n      if (canvasRef.current !== null) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      \n      requestAnimationFrame(()=>{drawDots(face, ctx, 1, showCanvas)});\n      }\n    }\n  };\n\n\n  return (\n    <div className=\"App\">\n      <AppBar/>\n      <Container className={classes.container_root}>\n      {/* <Button variant=\"contained\" color=\"secondary\" onClick={capture}>拍照截图</Button> */}\n      <Grid container \n        spacing={2} style={{margin: 10}}>\n      <Grid item xs={3}>\n      <Fab size=\"small\" color=\"primary\" aria-label=\"add\" onClick={capture}> \n        <CameraAltRoundedIcon />\n      </Fab>\n      </Grid>\n        {/* second button group */}\n        <Grid item xs={9}\n        display=\"flex\"\n        >\n      <ButtonGroup variant=\"contained\" color=\"secondary\" aria-label=\"contained primary button group\">\n        <Button\n          onClick={() => setDraw(draw + 1)}\n        >\n          下一个部位建模\n        </Button>\n        <Button\n          onClick={() => setDraw(draw - 1)}\n        >\n          返回上一个部位\n        </Button>\n        <Button \n        onClick={()=> setTimeout(() => {setAlertVisibility(true)},3000)}>\n          全脸扫描反馈\n      </Button>\n      <Button \n        onClick={()=> setTimeout(() => {setEyeVisibility(true)},5000)}>\n          眼部扫描反馈\n      </Button>\n      <Button \n        onClick={()=>{setShowCanvas(true)}}>\n          显示标点\n      </Button>\n      <Button \n        onClick={()=> {setShowCanvas(false)}}>\n          隐藏标点\n      </Button>\n        </ButtonGroup>\n        </Grid>\n        </Grid>\n      <div>current draw is {draw}.</div>\n      <Box style={{margin: 10 }}>\n        {imgSrc && (\n            // <img\n            //   src={imgSrc}\n            // />\n            <ImgCard img={imgSrc} />\n        )}\n        </Box>\n      </Container>\n      <div>\n      <DasAlerts\n        visible={visible}\n        duration={20000000}\n        onDurationEnd={setAlertVisibility}\n      >\n        <div>你的三庭比例为{(id_9[1]-id_10[1])/(id_152[1]-id_10[1])}:{(id_2[1]-id_9[1])/(id_152[1]-id_10[1])}:{(id_152[1]-id_2[1])/(id_152[1]-id_10[1])};{\"\\n\"}\n        你的五眼比例为{(id_130[0]-id_127[0])/(id_356[0]-id_127[0])}:{(id_243[0]-id_130[0])/(id_356[0]-id_127[0])}:{(id_463[0]-id_243[0])/(id_356[0]-id_127[0])}:\n        {(id_359[0]-id_463[0])/(id_356[0]-id_127[0])}:\n        {(id_356[0]-id_359[0])/(id_356[0]-id_127[0])}\n        </div>\n        </DasAlerts>\n      </div>\n      <div>\n      <DasAlerts\n        visible={eyeVisible}\n        duration={20000000}\n        onDurationEnd={setEyeVisibility}\n      >\n        <div>眼睛长度相较于五眼的比例：合适（85分）；眼睛宽度相较于中庭的比例：合适（80分）；眉眼距离：合适（80分）；眼间距：合适（80分）。</div>\n        </DasAlerts>\n      </div>\n      <div>\n      <DasAlerts\n        visible={eyeVisible}\n        duration={20000000}\n        onDurationEnd={setEyeVisibility}\n      >\n        <div>建议：使用妆容：日常妆容。 {\"\\n\"}1. 眉头至眼角C型区上阴影，加强立体感。 {\"\\n\"} \n        2. 由眼皮至眉尾使用深色系眼影淡扫，加强层次感  {\"\\n\"}3. 在下眼睑和眼尾使用深色系眼影淡扫，拉长眼长 {\"\\n\"} \n        4. 使用棕橘色加深褶皱和下眼尾 {\"\\n\"} 5. 在瞳孔正上方眼皮使用亮色点涂  {\"\\n\"}\n        6. 画内眼线和外眼线，外眼线眼尾微微上翘。若褶皱明显，建议省略外眼线，避免妆感过重  {\"\\n\"}\n        7. 夹睫毛，上睫毛膏</div>\n        </DasAlerts>\n      </div>\n      <header className=\"App-header\">\n        <Webcam\n          ref={webcamRef}\n          screenshotFormat=\"image/jpeg\"\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />\n        {showCanvas === true &&\n        <canvas\n          ref={canvasRef}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />\n        }\n        {/* {showCanvas === false &&\n        <canvas\n          ref={canvasRef_Tri}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />} */}\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}