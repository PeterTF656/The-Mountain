{"ast":null,"code":"var _jsxFileName = \"/Users/zelinpu/Desktop/the-mountain/src/App.js\";\n// 1. Install dependencies DONE\n// 2. Import dependencies DONE\n// 3. Setup webcam and canvas DONE\n// 4. Define references to those DONE\n// 5. Load posenet DONE\n// 6. Detect function DONE\n// 7. Drawing utilities from tensorflow DONE\n// 8. Draw functions DONE\n// Face Mesh - https://github.com/tensorflow/tfjs-models/tree/master/facemesh\nimport React, { useRef, useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport * as tf from \"@tensorflow/tfjs\"; // OLD MODEL\n//import * as facemesh from \"@tensorflow-models/facemesh\";\n// NEW MODEL\n\nimport * as facemesh from \"@tensorflow-models/face-landmarks-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawTri } from \"./utilities\";\nimport { drawDots } from \"./Dots\";\nimport DasAlerts from \"./report\";\nimport AppBar from \"./AppBar\";\nimport { Button, Container, ButtonGroup, makeStyles, Fab, Grid, Box } from '@material-ui/core';\nimport ImgCard from \"./Snip.js\";\nimport CameraAltRoundedIcon from '@material-ui/icons/CameraAltRounded'; // import EditIcon from '@material-ui/icons/Edit';\n// import UpIcon from '@material-ui/icons/KeyboardArrowUp';\n// import { green } from '@material-ui/core/colors';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    '& > *': {\n      margin: theme.spacing(),\n      marginTop: theme.spacing(3)\n    },\n    container_root: {\n      margin: theme.spacing(2),\n      display: 'flex'\n    },\n    fab_one: {\n      position: 'absolute',\n      bottom: theme.spacing(2),\n      left: theme.spacing(2)\n    } // fab_two: {\n    //   position: 'absolute',\n    //   bottom: theme.spacing(3),\n    //   left: theme.spacing(2),\n    // },\n    // fab_three: {\n    //   position: 'absolute',\n    //   bottom: theme.spacing(4),\n    //   left: theme.spacing(2),\n    // },\n    // fab_four: {\n    //   position: 'absolute',\n    //   bottom: theme.spacing(5),\n    //   left: theme.spacing(2),\n    // },\n    // fab_five: {\n    //   position: 'absolute',\n    //   bottom: theme.spacing(6),\n    //   left: theme.spacing(2),\n    // },\n    // fab_six: {\n    //   position: 'absolute',\n    //   bottom: theme.spacing(7),\n    //   left: theme.spacing(2),\n    // },\n\n  }\n}));\n\nfunction App() {\n  const classes = useStyles();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const canvasRef_Tri = useRef(null);\n  const [draw, setDraw] = useState(1);\n  const [visible, setAlertVisibility] = useState(false);\n  const [eyeVisible, setEyeVisibility] = useState(false);\n  const [id_2, setId_2] = useState([0.1, 0.1]);\n  const [id_152, setId_152] = useState([0.11, 0.11]);\n  const [id_9, setId_9] = useState([0.111, 0.111]);\n  const [id_10, setId_10] = useState([0.1111, 0.1111]);\n  const [id_127, setId_127] = useState([0.2, 0.2]);\n  const [id_130, setId_130] = useState([0.21, 0.21]);\n  const [id_243, setId_243] = useState([0.12, 0.12]);\n  const [id_463, setId_463] = useState([0.122, 0.122]);\n  const [id_359, setId_359] = useState([0.212, 0.212]);\n  const [id_356, setId_356] = useState([0.01, 0.01]);\n  const [showCanvas, setShowCanvas] = useState(true);\n  const [imgSrc, setImgSrc] = React.useState(null); // take photos\n\n  const capture = React.useCallback(() => {\n    const imageSrc = webcamRef.current.getScreenshot({\n      width: 400,\n      height: 400\n    });\n    setImgSrc(imageSrc);\n  }, [webcamRef, setImgSrc]); //  Load posenet\n\n  const runFaceTri = async key => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    const interval = setInterval(() => {\n      detectTri(net, key);\n    }, 1);\n    return () => clearInterval(interval);\n  };\n\n  const detectTri = async (net, key) => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight; // Set video width\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight; // Set canvas width\n\n      if (canvasRef_Tri.current !== null) {\n        canvasRef_Tri.current.width = videoWidth;\n        canvasRef_Tri.current.height = videoHeight;\n      }\n\n      const face = await net.estimateFaces({\n        input: video\n      }); // console.log(face);\n\n      if (typeof face[\"0\"] !== \"undefined\") {\n        // face[\"0\"].scaledMesh[9] = parseFloat(face[\"0\"].scaledMesh[9]).toFixed(4);\n        // face[\"0\"].scaledMesh[10] = parseFloat(face[\"0\"].scaledMesh[10]).toFixed(4);\n        // face[\"0\"].scaledMesh[2] = parseFloat(face[\"0\"].scaledMesh[2]).toFixed(4);\n        // face[\"0\"].scaledMesh[152] = parseFloat(face[\"0\"].scaledMesh[152]).toFixed(4);\n        // face[\"0\"].scaledMesh[127] = parseFloat(face[\"0\"].scaledMesh[127]).toFixed(4);\n        // face[\"0\"].scaledMesh[130] = parseFloat(face[\"0\"].scaledMesh[130]).toFixed(4);\n        // face[\"0\"].scaledMesh[243] = parseFloat(face[\"0\"].scaledMesh[243]).toFixed(4);\n        // face[\"0\"].scaledMesh[463] = parseFloat(face[\"0\"].scaledMesh[463]).toFixed(4);\n        // face[\"0\"].scaledMesh[359] = parseFloat(face[\"0\"].scaledMesh[359]).toFixed(4);\n        // face[\"0\"].scaledMesh[356] = parseFloat(face[\"0\"].scaledMesh[356]).toFixed(4);\n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]);\n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      } // Get canvas context\n\n\n      if (canvasRef_Tri.current !== null) {\n        const ctx = canvasRef_Tri.current.getContext(\"2d\");\n        requestAnimationFrame(() => {\n          drawTri(face, ctx, draw);\n        });\n      }\n    }\n  };\n\n  const runFaceDots = async (key, dot) => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    const interval = setInterval(() => {\n      detectDots(net, key, dot);\n    }, 1);\n    return () => clearInterval(interval);\n  };\n\n  const detectDots = async (net, key, dot) => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight; // Set video width\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight; // Set canvas width\n\n      if (canvasRef.current !== null) {\n        canvasRef.current.width = videoWidth;\n        canvasRef.current.height = videoHeight;\n      } // Make Detections\n      // OLD MODEL\n      //       const face = await net.estimateFaces(video);\n      // NEW MODEL\n\n\n      const face = await net.estimateFaces({\n        input: video\n      }); // console.log(face);\n      // Get canvas context\n\n      if (canvasRef.current !== null) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        requestAnimationFrame(() => {\n          drawDots(face, ctx, draw, showCanvas);\n        });\n      }\n    }\n  }; // useEffect(()=>{ return () => {}},[showCanvas]);\n\n\n  useEffect(() => {\n    runFaceDots();\n    runFaceTri();\n    return () => {};\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Container, {\n    className: classes.container_root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 2,\n    style: {\n      margin: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Fab, {\n    size: \"small\",\n    color: \"primary\",\n    \"aria-label\": \"add\",\n    onClick: capture,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(CameraAltRoundedIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 9\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 9,\n    display: \"flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    variant: \"contained\",\n    color: \"secondary\",\n    \"aria-label\": \"contained primary button group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setDraw(draw + 1),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 9\n    }\n  }, \"\\u4E0B\\u4E00\\u4E2A\\u90E8\\u4F4D\\u5EFA\\u6A21\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setDraw(draw - 1),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 9\n    }\n  }, \"\\u8FD4\\u56DE\\u4E0A\\u4E00\\u4E2A\\u90E8\\u4F4D\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setTimeout(() => {\n      setAlertVisibility(true);\n    }, 3000),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 9\n    }\n  }, \"\\u5168\\u8138\\u626B\\u63CF\\u53CD\\u9988\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setTimeout(() => {\n      setEyeVisibility(true);\n    }, 5000),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 7\n    }\n  }, \"\\u773C\\u90E8\\u626B\\u63CF\\u53CD\\u9988\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setShowCanvas(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 7\n    }\n  }, \"\\u663E\\u793A\\u6807\\u70B9\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setShowCanvas(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }\n  }, \"\\u9690\\u85CF\\u6807\\u70B9\")))), /*#__PURE__*/React.createElement(Box, {\n    style: {\n      margin: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 7\n    }\n  }, imgSrc &&\n  /*#__PURE__*/\n  // <img\n  //   src={imgSrc}\n  // />\n  React.createElement(ImgCard, {\n    img: imgSrc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: visible,\n    duration: 20000000,\n    onDurationEnd: setAlertVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 9\n    }\n  }, \"\\u4F60\\u7684\\u4E09\\u5EAD\\u6BD4\\u4F8B\\u4E3A\", (id_9[1] - id_10[1]) / (id_152[1] - id_10[1]), \":\", (id_2[1] - id_9[1]) / (id_152[1] - id_10[1]), \":\", (id_152[1] - id_2[1]) / (id_152[1] - id_10[1]), \";\", \"\\n\", \"\\u4F60\\u7684\\u4E94\\u773C\\u6BD4\\u4F8B\\u4E3A\", (id_130[0] - id_127[0]) / (id_356[0] - id_127[0]), \":\", (id_243[0] - id_130[0]) / (id_356[0] - id_127[0]), \":\", (id_463[0] - id_243[0]) / (id_356[0] - id_127[0]), \":\", (id_359[0] - id_463[0]) / (id_356[0] - id_127[0]), \":\", (id_356[0] - id_359[0]) / (id_356[0] - id_127[0])))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: eyeVisible,\n    duration: 20000000,\n    onDurationEnd: setEyeVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 9\n    }\n  }, \"\\u773C\\u775B\\u957F\\u5EA6\\u76F8\\u8F83\\u4E8E\\u4E94\\u773C\\u7684\\u6BD4\\u4F8B\\uFF1A\\u5408\\u9002\\uFF0885\\u5206\\uFF09\\uFF1B\\u773C\\u775B\\u5BBD\\u5EA6\\u76F8\\u8F83\\u4E8E\\u4E2D\\u5EAD\\u7684\\u6BD4\\u4F8B\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\uFF1B\\u7709\\u773C\\u8DDD\\u79BB\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\uFF1B\\u773C\\u95F4\\u8DDD\\uFF1A\\u5408\\u9002\\uFF0880\\u5206\\uFF09\\u3002\"))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DasAlerts, {\n    visible: eyeVisible,\n    duration: 20000000,\n    onDurationEnd: setEyeVisibility,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 9\n    }\n  }, \"\\u5EFA\\u8BAE\\uFF1A\\u4F7F\\u7528\\u5986\\u5BB9\\uFF1A\\u65E5\\u5E38\\u5986\\u5BB9\\u3002 \", \"\\n\", \"1. \\u7709\\u5934\\u81F3\\u773C\\u89D2C\\u578B\\u533A\\u4E0A\\u9634\\u5F71\\uFF0C\\u52A0\\u5F3A\\u7ACB\\u4F53\\u611F\\u3002 \", \"\\n\", \"2. \\u7531\\u773C\\u76AE\\u81F3\\u7709\\u5C3E\\u4F7F\\u7528\\u6DF1\\u8272\\u7CFB\\u773C\\u5F71\\u6DE1\\u626B\\uFF0C\\u52A0\\u5F3A\\u5C42\\u6B21\\u611F  \", \"\\n\", \"3. \\u5728\\u4E0B\\u773C\\u7751\\u548C\\u773C\\u5C3E\\u4F7F\\u7528\\u6DF1\\u8272\\u7CFB\\u773C\\u5F71\\u6DE1\\u626B\\uFF0C\\u62C9\\u957F\\u773C\\u957F \", \"\\n\", \"4. \\u4F7F\\u7528\\u68D5\\u6A58\\u8272\\u52A0\\u6DF1\\u8936\\u76B1\\u548C\\u4E0B\\u773C\\u5C3E \", \"\\n\", \" 5. \\u5728\\u77B3\\u5B54\\u6B63\\u4E0A\\u65B9\\u773C\\u76AE\\u4F7F\\u7528\\u4EAE\\u8272\\u70B9\\u6D82  \", \"\\n\", \"6. \\u753B\\u5185\\u773C\\u7EBF\\u548C\\u5916\\u773C\\u7EBF\\uFF0C\\u5916\\u773C\\u7EBF\\u773C\\u5C3E\\u5FAE\\u5FAE\\u4E0A\\u7FD8\\u3002\\u82E5\\u8936\\u76B1\\u660E\\u663E\\uFF0C\\u5EFA\\u8BAE\\u7701\\u7565\\u5916\\u773C\\u7EBF\\uFF0C\\u907F\\u514D\\u5986\\u611F\\u8FC7\\u91CD  \", \"\\n\", \"7. \\u5939\\u776B\\u6BDB\\uFF0C\\u4E0A\\u776B\\u6BDB\\u818F\"))), /*#__PURE__*/React.createElement(\"header\", {\n    className: \"App-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamRef,\n    screenshotFormat: \"image/jpeg\",\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      position: \"absolute\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zindex: 9,\n      width: 1000,\n      height: 750\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/zelinpu/Desktop/the-mountain/src/App.js"],"names":["React","useRef","useEffect","useState","tf","facemesh","Webcam","drawTri","drawDots","DasAlerts","AppBar","Button","Container","ButtonGroup","makeStyles","Fab","Grid","Box","ImgCard","CameraAltRoundedIcon","useStyles","theme","root","display","flexDirection","alignItems","margin","spacing","marginTop","container_root","fab_one","position","bottom","left","App","classes","webcamRef","canvasRef","canvasRef_Tri","draw","setDraw","visible","setAlertVisibility","eyeVisible","setEyeVisibility","id_2","setId_2","id_152","setId_152","id_9","setId_9","id_10","setId_10","id_127","setId_127","id_130","setId_130","id_243","setId_243","id_463","setId_463","id_359","setId_359","id_356","setId_356","showCanvas","setShowCanvas","imgSrc","setImgSrc","capture","useCallback","imageSrc","current","getScreenshot","width","height","runFaceTri","key","net","load","SupportedPackages","mediapipeFacemesh","interval","setInterval","detectTri","clearInterval","video","readyState","videoWidth","videoHeight","face","estimateFaces","input","scaledMesh","ctx","getContext","requestAnimationFrame","runFaceDots","dot","detectDots","setTimeout","marginLeft","marginRight","right","textAlign","zindex"],"mappings":"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","sourcesContent":["// 1. Install dependencies DONE\n// 2. Import dependencies DONE\n// 3. Setup webcam and canvas DONE\n// 4. Define references to those DONE\n// 5. Load posenet DONE\n// 6. Detect function DONE\n// 7. Drawing utilities from tensorflow DONE\n// 8. Draw functions DONE\n\n// Face Mesh - https://github.com/tensorflow/tfjs-models/tree/master/facemesh\n\nimport React, { useRef, useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport * as tf from \"@tensorflow/tfjs\";\n// OLD MODEL\n//import * as facemesh from \"@tensorflow-models/facemesh\";\n\n// NEW MODEL\nimport * as facemesh from \"@tensorflow-models/face-landmarks-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawTri } from \"./utilities\";\nimport { drawDots } from \"./Dots\"\nimport DasAlerts from \"./report\";\nimport AppBar from \"./AppBar\";\n\nimport {Button, Container, ButtonGroup, makeStyles, Fab, Grid, Box} from '@material-ui/core';\nimport ImgCard from \"./Snip.js\";\nimport CameraAltRoundedIcon from '@material-ui/icons/CameraAltRounded';\n// import EditIcon from '@material-ui/icons/Edit';\n// import UpIcon from '@material-ui/icons/KeyboardArrowUp';\n// import { green } from '@material-ui/core/colors';\n\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    '& > *': {\n      margin: theme.spacing(),\n      marginTop: theme.spacing(3),\n    },\n  container_root: {\n    margin: theme.spacing(2),\n    display: 'flex',\n  },\n  fab_one: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n  },\n  // fab_two: {\n  //   position: 'absolute',\n  //   bottom: theme.spacing(3),\n  //   left: theme.spacing(2),\n  // },\n  // fab_three: {\n  //   position: 'absolute',\n  //   bottom: theme.spacing(4),\n  //   left: theme.spacing(2),\n  // },\n  // fab_four: {\n  //   position: 'absolute',\n  //   bottom: theme.spacing(5),\n  //   left: theme.spacing(2),\n  // },\n  // fab_five: {\n  //   position: 'absolute',\n  //   bottom: theme.spacing(6),\n  //   left: theme.spacing(2),\n  // },\n  // fab_six: {\n  //   position: 'absolute',\n  //   bottom: theme.spacing(7),\n  //   left: theme.spacing(2),\n  // },\n  },\n}));\n\n\nfunction App() {\n  const classes = useStyles();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const canvasRef_Tri = useRef(null);\n  const [draw, setDraw] = useState(1);\n  const [visible, setAlertVisibility] = useState(false);\n  const [eyeVisible, setEyeVisibility] = useState(false);\n  const [id_2, setId_2] = useState([0.1,0.1])\n  const [id_152, setId_152] = useState([0.11,0.11])\n  const [id_9, setId_9] = useState([0.111,0.111])\n  const [id_10, setId_10] = useState([0.1111,0.1111])\n  const [id_127, setId_127] = useState([0.2,0.2])\n  const [id_130, setId_130] = useState([0.21,0.21])\n  const [id_243, setId_243] = useState([0.12,0.12])\n  const [id_463, setId_463] = useState([0.122,0.122])\n  const [id_359, setId_359] = useState([0.212,0.212])\n  const [id_356, setId_356] = useState([0.01,0.01])\n  const [showCanvas, setShowCanvas] = useState(true)\n  const [imgSrc, setImgSrc] = React.useState(null);\n\n  // take photos\n    const capture = React.useCallback(() => {\n      const imageSrc = webcamRef.current.getScreenshot({width: 400, height: 400});\n      setImgSrc(imageSrc);\n    }, [webcamRef, setImgSrc]);\n\n\n  //  Load posenet\n  const runFaceTri = async (key) => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    const interval = setInterval(() => {\n      detectTri(net, key);\n    }, 1);\n    return ()=>clearInterval(interval);\n  };\n\n  const detectTri = async (net, key) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight;\n\n      // Set video width\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      // Set canvas width\n      if (canvasRef_Tri.current !== null) {\n      canvasRef_Tri.current.width = videoWidth;\n      canvasRef_Tri.current.height = videoHeight;\n      }\n\n      const face = await net.estimateFaces({input:video});\n      // console.log(face);\n\n      \n      if (typeof face[\"0\"] !== \"undefined\") {        \n        // face[\"0\"].scaledMesh[9] = parseFloat(face[\"0\"].scaledMesh[9]).toFixed(4);\n        // face[\"0\"].scaledMesh[10] = parseFloat(face[\"0\"].scaledMesh[10]).toFixed(4);\n        // face[\"0\"].scaledMesh[2] = parseFloat(face[\"0\"].scaledMesh[2]).toFixed(4);\n        // face[\"0\"].scaledMesh[152] = parseFloat(face[\"0\"].scaledMesh[152]).toFixed(4);\n        // face[\"0\"].scaledMesh[127] = parseFloat(face[\"0\"].scaledMesh[127]).toFixed(4);\n        // face[\"0\"].scaledMesh[130] = parseFloat(face[\"0\"].scaledMesh[130]).toFixed(4);\n        // face[\"0\"].scaledMesh[243] = parseFloat(face[\"0\"].scaledMesh[243]).toFixed(4);\n        // face[\"0\"].scaledMesh[463] = parseFloat(face[\"0\"].scaledMesh[463]).toFixed(4);\n        // face[\"0\"].scaledMesh[359] = parseFloat(face[\"0\"].scaledMesh[359]).toFixed(4);\n        // face[\"0\"].scaledMesh[356] = parseFloat(face[\"0\"].scaledMesh[356]).toFixed(4);\n        setId_9(face[\"0\"].scaledMesh[9]);\n        setId_10(face[\"0\"].scaledMesh[10]);\n        setId_2(face[\"0\"].scaledMesh[2]);\n        setId_152(face[\"0\"].scaledMesh[152]);\n        setId_127(face[\"0\"].scaledMesh[127]);\n        setId_130(face[\"0\"].scaledMesh[130]); \n        setId_243(face[\"0\"].scaledMesh[243]);\n        setId_463(face[\"0\"].scaledMesh[463]);\n        setId_359(face[\"0\"].scaledMesh[359]);\n        setId_356(face[\"0\"].scaledMesh[356]);\n      }\n\n      // Get canvas context\n      if (canvasRef_Tri.current !== null) {\n      const ctx = canvasRef_Tri.current.getContext(\"2d\");\n      requestAnimationFrame(()=>{drawTri(face, ctx, draw)});\n      }\n    }\n  };\n\n  const runFaceDots = async (key, dot) => {\n    // OLD MODEL\n    // const net = await facemesh.load({\n    //   inputResolution: { width: 640, height: 480 },\n    //   scale: 0.8,\n    // });\n    // NEW MODEL\n    const net = await facemesh.load(facemesh.SupportedPackages.mediapipeFacemesh);\n    const interval = setInterval(() => {\n      detectDots(net, key, dot);\n    }, 1);\n    return ()=>clearInterval(interval);\n  };\n\n  const detectDots = async (net, key, dot) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      // Get Video Properties\n      const video = webcamRef.current.video;\n      const videoWidth = webcamRef.current.video.videoWidth;\n      const videoHeight = webcamRef.current.video.videoHeight;\n\n      // Set video width\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      // Set canvas width\n      if (canvasRef.current !== null) {\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      }\n\n      // Make Detections\n      // OLD MODEL\n      //       const face = await net.estimateFaces(video);\n      // NEW MODEL\n      const face = await net.estimateFaces({input:video});\n      // console.log(face);\n      // Get canvas context\n      if (canvasRef.current !== null) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      requestAnimationFrame(()=>{drawDots(face, ctx, draw, showCanvas)});\n      }\n    }\n  };\n\n  // useEffect(()=>{ return () => {}},[showCanvas]);\n  useEffect(()=>{runFaceDots(); runFaceTri();return () => {}}, [])\n\n  return (\n    <div className=\"App\">\n      <AppBar/>\n      <Container className={classes.container_root}>\n      {/* <Button variant=\"contained\" color=\"secondary\" onClick={capture}>拍照截图</Button> */}\n      <Grid container \n        spacing={2} style={{margin: 10}}>\n      <Grid item xs={3}>\n      <Fab size=\"small\" color=\"primary\" aria-label=\"add\" onClick={capture}> \n        <CameraAltRoundedIcon />\n      </Fab>\n      </Grid>\n        {/* second button group */}\n        <Grid item xs={9}\n        display=\"flex\"\n        >\n      <ButtonGroup variant=\"contained\" color=\"secondary\" aria-label=\"contained primary button group\">\n        <Button\n          onClick={() => setDraw(draw + 1)}\n        >\n          下一个部位建模\n        </Button>\n        <Button\n          onClick={() => setDraw(draw - 1)}\n        >\n          返回上一个部位\n        </Button>\n        <Button \n        onClick={()=> setTimeout(() => {setAlertVisibility(true)},3000)}>\n          全脸扫描反馈\n      </Button>\n      <Button \n        onClick={()=> setTimeout(() => {setEyeVisibility(true)},5000)}>\n          眼部扫描反馈\n      </Button>\n      <Button \n        onClick={()=>{setShowCanvas(true)}}>\n          显示标点\n      </Button>\n      <Button \n        onClick={()=> {setShowCanvas(false)}}>\n          隐藏标点\n      </Button>\n        </ButtonGroup>\n        </Grid>\n        </Grid>\n      {/* <div>current draw is {draw}.</div> */}\n      <Box style={{margin: 10 }}>\n        {imgSrc && (\n            // <img\n            //   src={imgSrc}\n            // />\n            <ImgCard img={imgSrc} />\n        )}\n        </Box>\n      </Container>\n      <div>\n      <DasAlerts\n        visible={visible}\n        duration={20000000}\n        onDurationEnd={setAlertVisibility}\n      >\n        <div>你的三庭比例为{(id_9[1]-id_10[1])/(id_152[1]-id_10[1])}:{(id_2[1]-id_9[1])/(id_152[1]-id_10[1])}:{(id_152[1]-id_2[1])/(id_152[1]-id_10[1])};{\"\\n\"}\n        你的五眼比例为{(id_130[0]-id_127[0])/(id_356[0]-id_127[0])}:{(id_243[0]-id_130[0])/(id_356[0]-id_127[0])}:{(id_463[0]-id_243[0])/(id_356[0]-id_127[0])}:\n        {(id_359[0]-id_463[0])/(id_356[0]-id_127[0])}:\n        {(id_356[0]-id_359[0])/(id_356[0]-id_127[0])}\n        </div>\n        </DasAlerts>\n      </div>\n      <div>\n      <DasAlerts\n        visible={eyeVisible}\n        duration={20000000}\n        onDurationEnd={setEyeVisibility}\n      >\n        <div>眼睛长度相较于五眼的比例：合适（85分）；眼睛宽度相较于中庭的比例：合适（80分）；眉眼距离：合适（80分）；眼间距：合适（80分）。</div>\n        </DasAlerts>\n      </div>\n      <div>\n      <DasAlerts\n        visible={eyeVisible}\n        duration={20000000}\n        onDurationEnd={setEyeVisibility}\n      >\n        <div>建议：使用妆容：日常妆容。 {\"\\n\"}1. 眉头至眼角C型区上阴影，加强立体感。 {\"\\n\"} \n        2. 由眼皮至眉尾使用深色系眼影淡扫，加强层次感  {\"\\n\"}3. 在下眼睑和眼尾使用深色系眼影淡扫，拉长眼长 {\"\\n\"} \n        4. 使用棕橘色加深褶皱和下眼尾 {\"\\n\"} 5. 在瞳孔正上方眼皮使用亮色点涂  {\"\\n\"}\n        6. 画内眼线和外眼线，外眼线眼尾微微上翘。若褶皱明显，建议省略外眼线，避免妆感过重  {\"\\n\"}\n        7. 夹睫毛，上睫毛膏</div>\n        </DasAlerts>\n      </div>\n      <header className=\"App-header\">\n        <Webcam\n          ref={webcamRef}\n          screenshotFormat=\"image/jpeg\"\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />\n        {/* {showCanvas === true && */}\n        <canvas\n          ref={canvasRef}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />\n        {/* } */}\n        {/* {showCanvas === false &&\n        <canvas\n          ref={canvasRef_Tri}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: 1000,\n            height: 750,\n          }}\n        />} */}\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}